<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speech Prompter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Merriweather:ital,wght@0,300;0,700;1,300&display=swap');

        body {
            background-color: #1a202c;
            color: #e2e8f0;
            font-family: 'Inter', sans-serif;
            overflow: hidden; /* App handles scrolling internally */
            height: 100vh;
        }

        /* --- Editor Styles --- */
        #interactive-area {
            line-height: 2;
            font-family: 'Merriweather', serif;
        }

        .word-span {
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 4px;
            transition: all 0.1s;
            display: inline-block;
            margin-right: 4px;
        }

        .word-span:hover {
            background-color: #2d3748;
        }

        /* Stressed Word Style */
        .is-stressed {
            color: #63b3ed; /* Light Blue */
            font-weight: 900;
            transform: scale(1.1);
            text-shadow: 0 0 10px rgba(99, 179, 237, 0.3);
        }

        /* Pause Marker Style */
        .pause-marker {
            color: #f56565; /* Red */
            font-weight: bold;
            margin-left: 2px;
            margin-right: 8px;
            font-family: monospace;
            font-size: 1.2em;
        }

        /* --- Prompter Styles --- */
        #prompter-view {
            background: black;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 50;
            display: none;
        }

        #prompter-content {
            padding: 50vh 10vw; /* Start/End padding so text scrolls fully */
            text-align: center;
            font-family: 'Merriweather', serif;
            color: #ffffff; /* Bright white as requested */
            transition: font-size 0.2s;
        }

        /* Prompter specific overrides */
        #prompter-content .word-span {
            margin-right: 0.3em;
        }

        #prompter-content .is-stressed {
            color: #63b3ed;
            font-weight: 900;
        }

        #prompter-content .pause-marker {
            color: #f56565;
            margin: 0 0.5em;
        }

        /* Focus Line Guide */
        #focus-guide {
            position: fixed;
            top: 45%;
            left: 0;
            width: 100%;
            height: 100px;
            border-top: 2px dashed rgba(255,255,255,0.1);
            border-bottom: 2px dashed rgba(255,255,255,0.1);
            pointer-events: none;
            z-index: 60;
            background: linear-gradient(to bottom, transparent, rgba(255,255,255,0.02), transparent);
        }

        /* Controls */
        #controls-bar {
            background: rgba(26, 32, 44, 0.95);
            backdrop-filter: blur(5px);
            border-top: 1px solid #4a5568;
        }

        /* Scrollbar hiding */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #2d3748; }
        ::-webkit-scrollbar-thumb { background: #4a5568; border-radius: 4px; }
    </style>
</head>
<body>

    <!-- ==================== EDITOR VIEW ==================== -->
    <div id="editor-view" class="h-full flex flex-col">
        
        <!-- Header / Toolbar -->
        <div class="p-4 bg-gray-800 border-b border-gray-700 flex justify-between items-center shadow-md z-10">
            <h1 class="text-xl font-bold text-gray-100"><i class="fas fa-scroll mr-2"></i>Speech Prompter</h1>
            
            <div class="flex gap-4">
                <!-- Mode Toggle -->
                <div class="bg-gray-700 p-1 rounded-lg flex text-sm">
                    <button id="mode-stress" onclick="setMode('stress')" class="px-4 py-1 rounded bg-blue-600 text-white font-bold transition-all">
                        Stress
                    </button>
                    <button id="mode-pause" onclick="setMode('pause')" class="px-4 py-1 rounded text-gray-400 hover:text-white transition-all">
                        Pause (//)
                    </button>
                </div>

                <button onclick="clearText()" class="text-gray-400 hover:text-red-400 text-sm px-2">
                    <i class="fas fa-trash"></i> Clear
                </button>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="flex-1 overflow-hidden relative flex">
            
            <!-- Raw Input (Shown initially) -->
            <textarea id="raw-input" class="w-full h-full bg-gray-900 text-gray-300 p-8 text-lg font-serif outline-none resize-none" 
            placeholder="Paste your speech text here..."></textarea>
            
            <!-- Interactive Area (Hidden initially) -->
            <div id="interactive-area" class="hidden w-full h-full overflow-y-auto bg-gray-900 text-gray-300 p-8 text-2xl font-serif"></div>

            <!-- Floating Action Button to process text -->
            <button id="process-btn" onclick="processText()" class="absolute bottom-8 right-8 bg-green-600 hover:bg-green-500 text-white p-4 rounded-full shadow-lg transition-transform hover:scale-110 z-20">
                <i class="fas fa-check text-xl"></i>
            </button>

            <!-- Floating Action Button to Launch (Hidden initially) -->
            <button id="launch-btn" onclick="launchPrompter()" class="hidden absolute bottom-8 right-8 bg-blue-600 hover:bg-blue-500 text-white px-6 py-4 rounded-full shadow-lg transition-transform hover:scale-105 z-20 font-bold flex items-center gap-2">
                <i class="fas fa-play"></i> Launch Prompter
            </button>
            
            <!-- Back to Edit button (Hidden initially) -->
            <button id="edit-btn" onclick="backToEdit()" class="hidden absolute bottom-8 left-8 bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg shadow-lg z-20">
                <i class="fas fa-pen"></i> Edit Text
            </button>
        </div>
        
        <div class="bg-gray-800 text-center text-xs text-gray-500 py-1">
            Tip: In 'Stress' mode, click words to bold them. In 'Pause' mode, click words to add a break.
        </div>
    </div>


    <!-- ==================== PROMPTER VIEW ==================== -->
    <div id="prompter-view">
        <div id="focus-guide"></div>
        
        <!-- Scrolling Container -->
        <div id="scroll-container" class="h-full overflow-y-hidden relative">
            <div id="prompter-content">
                <!-- Content injected via JS -->
            </div>
        </div>

        <!-- Prompter Controls -->
        <div id="controls-bar" class="absolute bottom-0 w-full p-4 flex flex-col gap-4">
            
            <!-- Top row: Playback -->
            <div class="flex justify-center items-center gap-6">
                <button onclick="restartPrompter()" class="text-gray-400 hover:text-white"><i class="fas fa-step-backward fa-lg"></i></button>
                
                <button id="play-pause-btn" onclick="togglePlay()" class="bg-white text-black w-12 h-12 rounded-full flex items-center justify-center hover:bg-gray-200 transition-colors">
                    <i class="fas fa-play ml-1"></i>
                </button>
                
                <button onclick="exitPrompter()" class="text-red-400 hover:text-red-300 text-sm font-bold absolute right-6">
                    EXIT
                </button>
            </div>

            <!-- Bottom row: Sliders -->
            <div class="flex justify-center gap-8 px-4 max-w-2xl mx-auto w-full">
                <div class="flex-1 flex items-center gap-3">
                    <i class="fas fa-tachometer-alt text-gray-500"></i>
                    <input type="range" id="speed-slider" min="0" max="100" value="20" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500">
                </div>
                <div class="flex-1 flex items-center gap-3">
                    <i class="fas fa-text-height text-gray-500"></i>
                    <input type="range" id="size-slider" min="20" max="100" value="50" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500">
                </div>
            </div>
        </div>
    </div>


    <script>
        // State
        let currentMode = 'stress'; // 'stress' or 'pause'
        let isPrompterRunning = false;
        let scrollSpeed = 2; // Pixels per frame
        let scrollInterval;
        let currentScroll = 0;

        // Elements
        const rawInput = document.getElementById('raw-input');
        const interactiveArea = document.getElementById('interactive-area');
        const processBtn = document.getElementById('process-btn');
        const launchBtn = document.getElementById('launch-btn');
        const editBtn = document.getElementById('edit-btn');
        const modeStressBtn = document.getElementById('mode-stress');
        const modePauseBtn = document.getElementById('mode-pause');
        
        // Prompter Elements
        const prompterView = document.getElementById('prompter-view');
        const prompterContent = document.getElementById('prompter-content');
        const scrollContainer = document.getElementById('scroll-container');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const speedSlider = document.getElementById('speed-slider');
        const sizeSlider = document.getElementById('size-slider');

        // --- Editor Logic ---

        function processText() {
            const text = rawInput.value.trim();
            if (!text) return;

            // Simple split by spaces/newlines to create spans
            // We preserve newlines by replacing them with <br> logic later if needed, 
            // but for a prompter, usually flow is continuous or paragraph based.
            // Let's split by whitespace but keep paragraph structure.
            
            const paragraphs = text.split(/\n+/);
            interactiveArea.innerHTML = '';

            paragraphs.forEach(para => {
                const pDiv = document.createElement('div');
                pDiv.className = "mb-8"; // Margin between paragraphs
                
                const words = para.split(' ');
                words.forEach(word => {
                    if(!word) return;
                    const span = document.createElement('span');
                    span.textContent = word;
                    span.className = 'word-span';
                    span.onclick = () => handleWordClick(span);
                    pDiv.appendChild(span);
                });
                interactiveArea.appendChild(pDiv);
            });

            // Switch Views
            rawInput.classList.add('hidden');
            interactiveArea.classList.remove('hidden');
            processBtn.classList.add('hidden');
            launchBtn.classList.remove('hidden');
            editBtn.classList.remove('hidden');
        }

        function backToEdit() {
            // NOTE: We lose styling if we go back to raw text. 
            // For a simple app, we might just assume "Edit Text" means re-pasting.
            // Or we just hide the interactive layer.
            interactiveArea.classList.add('hidden');
            rawInput.classList.remove('hidden');
            processBtn.classList.remove('hidden');
            launchBtn.classList.add('hidden');
            editBtn.classList.add('hidden');
        }

        function clearText() {
            if(confirm('Clear all text?')) {
                rawInput.value = '';
                backToEdit();
            }
        }

        function setMode(mode) {
            currentMode = mode;
            if (mode === 'stress') {
                modeStressBtn.className = "px-4 py-1 rounded bg-blue-600 text-white font-bold transition-all";
                modePauseBtn.className = "px-4 py-1 rounded text-gray-400 hover:text-white transition-all";
            } else {
                modePauseBtn.className = "px-4 py-1 rounded bg-red-500 text-white font-bold transition-all";
                modeStressBtn.className = "px-4 py-1 rounded text-gray-400 hover:text-white transition-all";
            }
        }

        function handleWordClick(span) {
            if (currentMode === 'stress') {
                span.classList.toggle('is-stressed');
            } else if (currentMode === 'pause') {
                // Check if next sibling is a pause marker
                const next = span.nextSibling;
                if (next && next.classList && next.classList.contains('pause-marker')) {
                    // Remove it
                    next.remove();
                } else {
                    // Add it
                    const marker = document.createElement('span');
                    marker.className = 'pause-marker';
                    marker.textContent = '//';
                    span.parentNode.insertBefore(marker, span.nextSibling);
                }
            }
        }

        // --- Prompter Logic ---

        function launchPrompter() {
            // Clone the content from interactive area to prompter
            prompterContent.innerHTML = interactiveArea.innerHTML;
            prompterView.style.display = 'block';
            
            // Apply default size
            updateSize();
            
            isPrompterRunning = false;
            playPauseBtn.innerHTML = '<i class="fas fa-play ml-1"></i>';
            currentScroll = 0;
            scrollContainer.scrollTop = 0;
        }

        function exitPrompter() {
            stopScroll();
            prompterView.style.display = 'none';
        }

        function togglePlay() {
            if (isPrompterRunning) {
                stopScroll();
            } else {
                startScroll();
            }
        }

        function startScroll() {
            isPrompterRunning = true;
            playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            
            function animate() {
                if (!isPrompterRunning) return;
                
                // Get speed from slider (exponential curve for better control)
                const rawSpeed = parseInt(speedSlider.value);
                // Map 0-100 to 0-5 pixels
                const pixels = (rawSpeed * rawSpeed) / 2000; 

                if (pixels > 0) {
                    currentScroll += pixels;
                    scrollContainer.scrollTop = currentScroll;
                }
                
                requestAnimationFrame(animate);
            }
            requestAnimationFrame(animate);
        }

        function stopScroll() {
            isPrompterRunning = false;
            playPauseBtn.innerHTML = '<i class="fas fa-play ml-1"></i>';
            // Sync currentScroll with actual scroll position in case user manually scrolled
            currentScroll = scrollContainer.scrollTop;
        }

        function restartPrompter() {
            stopScroll();
            scrollContainer.scrollTop = 0;
            currentScroll = 0;
        }

        function updateSize() {
            const size = sizeSlider.value;
            prompterContent.style.fontSize = size + 'px';
        }

        // Event Listeners
        sizeSlider.addEventListener('input', updateSize);
        
        // Handle manual scrolling to update our scroll tracker
        scrollContainer.addEventListener('scroll', () => {
            if (!isPrompterRunning) {
                currentScroll = scrollContainer.scrollTop;
            }
        });

    </script>
</body>
</html>
